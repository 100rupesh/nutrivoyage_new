{% extends 'core/base.html' %}
{% load static %}
{% block title %}Client List{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'appointments/css/appointment_list.css' %}"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css"/>


{% endblock %}
{% block content %}

<!-- <!DOCTYPE html>
<html lang="en">    
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>User List</title>

  <!-- DataTables CSS -->

<div class="container">
  <h1>Appointment List</h1>
  <div class="header-component">
    <div class="col-1 d-none">
  <label for="min-date">Start Date:</label>
<input type="date" id="min-date">

<label for="max-date">End Date:</label>
<input type="date" id="max-date">
</div>
<div class="col">
  <button><a href="/appointment/create/">New Appointment</a></button>
</div>
</div>
  <table id="usersTable" class="display" style="width:100%">
    <thead>
      <tr>
        <th>User</th>
        <th>Appointment Type</th>
        <th>Date</th>
        
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for appointment in appointments %}
      <tr>
        <td>{{ appointment.patient.client_profile.first_name }}</td>
        
        <td>{{ appointment.appointment_type }}</td>
        <td>{{ appointment.datetime }}</td>
        <!-- <td>{{ appointment.notes }}</td> -->
        <!-- <td>{% if user.is_staff %}Yes{% else %}No{% endif %}</td> -->
        <td><a href="/client/edit/{{user.id}}" class="btn btn-edit" title="Edit">Edit</a>
<a href="/appointment/detail/{{appointment.id}}/" class="btn btn-view" title="View">View</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <!-- DataTables JS -->
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <!-- DataTables Buttons -->
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

  <script>
    $(document).ready(function() {
      $('#usersTable').DataTable({
        dom: 'Bfrtip',
        buttons: [
          {
            extend: 'pdfHtml5',
            text: 'Export to PDF',
            className: 'dt-button buttons-pdf',
            title: 'User List',
            exportOptions: {
              columns: [0,1,2,3,4]  // Export all columns except Actions
            }
          }
        ],
        paging: true,
        searching: true,
        ordering: true,
      });
    });
   
  // Custom filtering function for date range
  $.fn.dataTable.ext.search.push(
    function(settings, data, dataIndex) {
      const min = $('#min-date').val();
      const max = $('#max-date').val();
      const date = data[3]; // Column index for 'Date'

      if (!min && !max) return true;

      const appointmentDate = new Date(date);
      const startDate = min ? new Date(min) : null;
      const endDate = max ? new Date(max) : null;

      if ((startDate === null || appointmentDate >= startDate) &&
          (endDate === null || appointmentDate <= endDate)) {
        return true;
      }

      return false;
    }
  );

  $(document).ready(function() {
    const table = $('#appointment-table').DataTable();

    $('#min-date, #max-date').on('change', function() {
      table.draw();
    });
  });

  </script>
</div>
{% endblock %}
